---
title: "Fases e Eventos de uma Proposição"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Fases e Eventos de uma Proposição}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

O [Analyzer](https://github.com/analytics-ufcg/agora-digital/blob/master/R/analyzer.R) realiza operações de reconhecimento de eventos e fases em dataframes de tramitação da Câmara e do Senado. Como possuem APIs distintas, cada casa possui um analyzer próprio adequado para os dados disponíveis em suas respectivas APIs. 

O `camara-analyzer.R` e o `senado-analyzer.R` extraem os locais (Comissões e Plenário), as fases da proposição na casa e eventos que ocorreram durante a tramitação de uma proposição na sua respectiva casa.

O primeiro passo para analisar dados de qualquer PL é identificar os ids do mesmo na Câmara e/ou no Senado. [Link para instruções sobre como achar o id de um PL](https://github.com/analytics-ufcg/agora-digital#como-capturar-ids-de-proposi%C3%A7%C3%B5es). 

Nesse exemplo, vamos utilizar a Lei da Qualidade Fiscal (PLS 229/2009 - Senado | PLP 295/2016 - Câmara).

```{r message=FALSE}
devtools::install_github('analytics-ufcg/agora-digital@refatora-build-scripts')
library(agoradigital)
library(tidyverse)
library(magrittr)

id_qualidade_fiscal_senado <- 91341
id_qualidade_fiscal_camara <- 2088990
```

### Câmara

```{r message=FALSE}
prop_camara <- agoradigital::fetch_proposicao(id_qualidade_fiscal_camara, 'camara')
tram_camara <- agoradigital::fetch_tramitacao(id_qualidade_fiscal_camara, 'camara')

eventos_camara <- agoradigital::process_proposicao(prop_camara, tram_camara, "camara")
eventos_camara %>% 
  select(data_hora, evento, local, casa)
```

<br />

Os dados retornados pela função **process_proposicao(id, "camara")**, além dos retornados pela [API Dados Abertos da Câmara](https://dadosabertos.camara.leg.br/swagger/api.html), estão distribuídos nas seguintes colunas:

* `evento`: Eventos importantes que ocorreram na tramitação;
* `local`: Local onde a proposição esteve/está;
* `casa`: A fase correspondente à situação da proposição na **Casa** onde ela se encontra. Podem ser: 
    * Apresentação: quando é apresentada na Câmara de Deputados;
    * Comissões: quando é designada às comissões para que um Relator seja designado, apresente seu Parecer e ele seja votado;
    * Plenário: quando é encaminhada ao Plenário (isso ocorre quando há divergência entre os Pareceres aprovados dos Relatores nas Comissões).

### Senado

```{r message=FALSE}
prop_senado <- agoradigital::fetch_proposicao(id_qualidade_fiscal_senado, 'senado')
tram_senado <- agoradigital::fetch_tramitacao(id_qualidade_fiscal_senado, 'senado')

eventos_senado <- agoradigital::process_proposicao(prop_senado, tram_senado, 'senado')
eventos_senado %>% 
  select(data_tramitacao, evento, local, casa, global)
```

<br />

Os dados retornados pela função **process_proposicao(prop_senado, tram_senado, "senado")**, além dos retornados pela [API Dados Abertos do Senado](https://www12.senado.leg.br/dados-abertos), estão distribuídos nas seguintes colunas:

* `fase`: Situação da proposição na **Comisssão** onde ela se encontra. Pode ser:
    * Recebimento: quando a proposição é recebida na Comissão;
    * Análise do relator: quando o Relator é designado;
    * Discussão e votação: quando o Relator apresenta seu Parecer e ele passa a ser votado na Comissão;
    * Encaminhamento: quando a proposição é votada e é encaminhada para a próxima Comissão, Plenário ou Casa.
* `casa`: A fase correspondente à situação da proposição na **Casa** onde ela se encontra. Pode ser: 
    * Apresentação: quando é apresentada na Câmara de Deputados;
    * Comissões: quando é designada às comissões para que um Relator seja designado, apresente seu Parecer e ele seja votado;
    * Plenário: quando é encaminhada ao Plenário (isso ocorre quando há divergência entre os Pareceres aprovados dos Relatores nas Comissões).
* `evento`: Eventos importantes que ocorreram na tramitação;
* `data_audiencia`: A data da realização da audiência pública (Este dado muitas vezes é confundido com a data que o despacho foi feito, então extraiu-se do próprio texto);
* `local`: Local onde a proposição esteve/está;
* `global`: Fase **global** onde a proposição se encontra. Pode ser:
    * Origem: Se a proposição está na Casa iniciadora, ou seja, a casa que criou a proposta;
    * Revisão: Se a proposição está na Casa Revisora (Câmara);
    * Réplica: Ocorre quando a proposição sofre alguma modificação na Casa Revisora e passa novamente na Casa iniciadora para Réplica;

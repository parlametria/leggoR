---
title: "Temperatura da Proposição por Temas"
output: html_notebook
---

Neste relatório, faremos uma análise histórica da Temperatura das proposições agregadas por tema ao longo dos anos.

```{r}
library(dplyr)
library(magrittr)
temperatura_props <- readr::read_csv('/local/tarciso/workspace/leggoR/data/hists_temperatura.csv')
props <- readr::read_csv('/local/tarciso/workspace/leggoR/data/tabela_geral_ids_casa.csv')

temas_props_camara <- props %>% select(id_camara, tema) %>% rename(id_ext = id_camara)
temas_props_senado <- props %>% select(id_senado, tema) %>% rename(id_ext = id_senado)
temas_props <- bind_rows(temas_props_camara,temas_props_senado) %>% filter(!is.na(id_ext))

temperatura_props_temas <- inner_join(temperatura_props,temas_props,by = "id_ext") %>%
  tidyr::separate_rows(tema,sep=';')

temperatura_temas <- temperatura_props_temas %>%
  mutate(semana = lubridate::floor_date(periodo, "weeks") + lubridate::days(1),
         ano = lubridate::year(periodo)) %>%
  group_by(tema,semana,ano) %>%
  summarise(num_obs = n(),
            min_temp = min(temperatura_recente),
            max_temp = max(temperatura_recente),
            median_temp = mean(temperatura_recente),
            mean_temp = median(temperatura_recente),
            std_temp = sd(temperatura_recente),
            var_temp = var(temperatura_recente))

temperatura_temas_2019 <- temperatura_temas %>% 
  dplyr::ungroup() %>%
  dplyr::filter(periodo >= lubridate::ymd('2019-01-01')) %>%
  dplyr::mutate(semana = lubridate::floor_date(periodo, "weeks") + lubridate::days(1),
                    ano = lubridate::year(periodo)) #%>%
  #dplyr::group_by(tema,semana,ano)


```

Vamos analisar graficamente a evolução da temperatura por tema, começando pelo ano 2019.
Primeiramente, uma análise geral, com a temperatura média por semana.

```{r}
library(ggplot2)

temperatura_temas %>% 
  dplyr::filter(semana >= lubridate::ymd('2019-01-01')) %>%
  ggplot2::ggplot(ggplot2::aes(x=as.Date(semana), y=median_temp)) +
  ggplot2::geom_col(position="dodge") +
  ggplot2::xlab("Tempo") + 
  ggplot2::ylab("Temperatura") +
  ggplot2::scale_x_date(date_labels = "%d-%m-%Y") +
  ggplot2::theme_minimal()

```

Agora mostrando todos os temas.

```{r}
temperatura_temas %>% 
  dplyr::filter(semana >= lubridate::ymd('2019-01-01')) %>%
  ggplot2::ggplot(ggplot2::aes(x=as.Date(semana), y=median_temp, fill=tema)) +
  ggplot2::geom_col(position="dodge") +
  ggplot2::xlab("Tempo") + 
  ggplot2::ylab("Temperatura") +
  ggplot2::scale_x_date(date_labels = "%d-%m-%Y") +
  ggplot2::theme_minimal()

```

Por fim, quebrando por tema.

```{r}
temperatura_temas %>% 
  dplyr::filter(ano == 2019) %>%
  ggplot2::ggplot(ggplot2::aes(x=as.Date(semana), y=median_temp, fill=tema)) +
  #ggplot2::geom_smooth(span = .05, se = F) +
  ggplot2::geom_bar(stat="identity", position="dodge") +
  #ggplot2::geom_point() +
  ggplot2::xlab("Tempo") + 
  ggplot2::ylab("Temperatura") +
  ggplot2::theme_minimal() +
  ggplot2::scale_x_date(date_labels = "%d-%m-%Y") +
  ggplot2::facet_grid(rows = vars(tema))

```

Repetindo a análise separada por tema para o ano de 2018.

```{r}
temperatura_temas %>% 
  dplyr::filter(ano == 2018) %>%
  ggplot2::ggplot(ggplot2::aes(x=as.Date(semana), y=median_temp, fill=tema)) +
  #ggplot2::geom_smooth(span = .05, se = F) +
  ggplot2::geom_bar(stat="identity", position="dodge") +
  #ggplot2::geom_point() +
  ggplot2::xlab("Tempo") + 
  ggplot2::ylab("Temperatura") +
  ggplot2::theme_minimal() +
  ggplot2::scale_x_date(date_labels = "%d-%m-%Y") +
  ggplot2::facet_grid(rows = vars(tema))

```

Repetindo a análise separada por tema para o ano de 2017.

```{r}
temperatura_temas %>% 
  dplyr::filter(ano == 2017) %>%
  ggplot2::ggplot(ggplot2::aes(x=as.Date(semana), y=median_temp, fill=tema)) +
  #ggplot2::geom_smooth(span = .05, se = F) +
  ggplot2::geom_bar(stat="identity", position="dodge") +
  #ggplot2::geom_point() +
  ggplot2::xlab("Tempo") + 
  ggplot2::ylab("Temperatura") +
  ggplot2::theme_minimal() +
  ggplot2::scale_x_date(date_labels = "%d-%m-%Y") +
  ggplot2::facet_grid(rows = vars(tema))

```

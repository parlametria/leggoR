---
output: html_document
params:
  id: 257161
  casa: 'camara'
---
```{r imports, echo=FALSE, message=FALSE, error=FALSE}
source(here::here('code/vis/tramitacao/extract-informations.R'))
source(here::here('code/vis/tramitacao/build-chart.R'))
source(here::here('code/senado-lib.R'))
library(rcongresso)

data <- extract_informations_from_single_house(params$id, params$casa)
chart <- create_chart(params$id, params$casa)
```
# Projeto de Lei `r toString(paste0(data$nome))`

### Informações Gerais

#### Autor:
 `r toString(data$autor)`

#### Casa de Origem:
 `r toString(data$casa_origem)`

#### Data de Apresentação:
 `r toString(data$data_apresentacao)`

#### Ementa:
`r toString(data$ementa)`

#### Status Atual:
`r toString(data$status_atual)`

#### Último Relator:
`r toString(data$ultimo_relator)`

#### Tramitação na casa `r toString(data$casa)`
```{r echo=FALSE, message=FALSE}
chart
```

#### Tabelas de apensação

```{r echo=FALSE, message=FALSE, warning=FALSE}
if(params$casa == "camara") {
  table_apensadas_camara <- gera_tabela_apensadas_camara(params$id) 
  knitr::kable(table_apensadas_camara, caption = "Lista de Leis Apensadas Câmara")
}else {
  table_apensadas_senado <- gera_tabela_apensadas_senado(params$id) 
  knitr::kable(table_apensadas_senado, caption = "Lista de Leis Apensadas Senado")
}
```

#### Requerimentos

```{r, echo = FALSE, message = FALSE, warning=FALSE}
reqs <- data.frame()

reqs <- tryCatch({
    return(gera_tabela_requerimentos(params$id,params$casa))
}, error = function(e) {
    return(data.frame())
})
```

```{r, echo = FALSE, results='asis'}

if (nrow(reqs) != 0) {
  knitr::kable(reqs)
}
```

#### Tabelas de eventos
```{r echo=FALSE, message=FALSE, warning=FALSE}
if(params$casa == "camara") {
  table_proximo_evento_camara <- get_next_events(params$id) 
  knitr::kable(table_proximo_evento_camara, caption = "Lista de Próximos eventos")
  
  table_ultimos_eventos_camara <- get_latest_events(params$id) 
  knitr::kable(table_ultimos_eventos_camara, caption = "Lista de Últimos eventos")
}
```

#### Tabelas de comissões
```{r echo=FALSE, message=FALSE, warning=FALSE}
data_path <- here::here('data/')
if(params$casa == "camara") {
  comissoes <- get_ditribuicao_comissoes_Camara(read_csv(paste0(data_path, "camara/tramitacao_camara_", params$id, ".csv")))
}else {
  comissoes <- extract_comissoes_Senado(read_csv(paste0(data_path, "Senado/", params$id, "-passage-senado.csv")))
}
  knitr::kable(comissoes, caption = "Lista de Comissões")
```